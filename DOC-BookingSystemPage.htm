<!-- DOCTOR BOOK/CONSULTATION MANAGEMENT PAGE --> 
 
<?php
	$dbhost = "sql12.freesqldatabase.com";
	 $dbuser = "sql12337112";
	 $dbpass = "yacY8zPDxP";
	 $db = "sql12337112";
	 $conn = new mysqli($dbhost, $dbuser, $dbpass,$db) or die("Connect failed: %s\n". $conn -> error);
	 $patientname = "karen"; 

	 $sqlValue = "SELECT * FROM `booking` WHERE `patientname`='$patientname'";
	 $resultValue = mysqli_query($conn,$sqlValue);
	if (mysqli_num_rows($resultValue) >= 1) {
		while($row = $resultValue->fetch_assoc()) {
			$time = $row['time'];
			$day = $row['day'];
			$month = $row['month'];
			$doctorname = $row['doctorname'];
		
	}
	$value = "Your booking is at " . "$time on " . "$day/$month " . " with $doctorname."; 
	} else {
		$value=""; 
	}


		$time = $_POST['time'];
		$day = $_POST['day'];
		$month = $_POST['month'];
		$doctorname = $_POST['doctorname'];


	//if($_SERVER["REQUEST_METHOD"] == "POST"){
	if(isset($_POST['submit'])) {
		if (empty($time) || empty($day) || empty($month) || empty($doctorname)) { 
		$message = "Please fill in all fields"; 
	}
	else { 
	$sql = "SELECT * FROM `users` WHERE `usertype`='Doctor' and `lastname`='$doctorname'";
	$result = mysqli_query($conn,$sql);
	if (mysqli_num_rows($result) == 1) {
	//Pass
		$query = "INSERT INTO `booking` (`time`, `day`, `month`, `doctorname`, `patientname`) VALUES ('$time', '$day', '$month','$doctorname', '$patientname')";
		if ($conn->query($query) === TRUE) {
		$value = "Your booking is at " . "$time on " . "$day/$month " . " with $doctorname."; 
	} else {
		$message = "Could not add to database";
	}
		
	} else {
		$message = "Doctor name does not exist"; 
	//Fail
	}
	} 
	}


	if(isset($_POST['delete'])) {
		
		$sql2 = "DELETE FROM `booking` WHERE `patientname`='$patientname'";
		$result2 = mysqli_query($conn,$sql2);
	if (mysqli_affected_rows($conn) > 0) {
	//Pass
		$message = "Booking deleted"; 
		 }else {
		$message = "no booking existed"; 
	//Fail
	}
		}




	$conn->close();
?>

<!DOCTYPE html>
<html> 
	<script src="https://kit.fontawesome.com/56b24aa4ed.js" crossorigin="anonymous"></script>
	<head>
		<style>
			.container {
  padding: 40px;
  background-color: white;
}
.button {
  background-color: #add8e6;
  border: none;
  color: white;
  padding: 15px 32px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  cursor: pointer;
}
.button:hover { 
	
	color: black;
 }
 input[type="value"] {  
                text-align: center; 
            } 
</style>
		<title>Online Medical Centre</title> <!-- This is the title of the site that shows up in the tab feel free to change it -->
		<link rel="stylesheet" href="WebsiteStyling.css"> <!-- The css file -->
		<script src="WebsiteScript.js"></script> <!-- the javascript file -->
		<link rel="icon" type="image/x-icon" href="favicon.ico"/> <!-- icon file -->
	</head>	
	<body>
		<!-- fixed top navigation bar -->
		<header>
			<div class="navigation" id="nav"> 
				<a id="websiteHeading" href="#websiteHeading" onclick="window.location.href='DOC-HomePage.htm'"><i class="fas fa-clinic-medical"></i><b> Online Medical Centre</b></a>
				<div class="navbar-right">
					<a href="#home" onclick="window.location.href='DOC-HomePage.htm'"><i class="fas fa-home"></i><b> Home</b></a>
					<a href="#consultations" onclick="window.location.href='DOC-BookingSystemPage.htm'"><i class="fas fa-calendar-alt"></i><b> Consulations</b></a>
					<a href="#accountSettings" onclick="window.location.href='DOC-UserSettingPage.htm'"><i class="fas fa-user-cog"></i><b> My Account</b></a>
					<a href="#logout" onclick="window.location.href='MAIN-LandingPage.htm'"><i class="fas fa-sign-out-alt"></i><b> Log Out</b></a>
				</div>
				
				<!-- change to toggle menu if the window size is too small to fit top navigation bar comfortably -->
				<a href="javascript:void(0);" class="icon" onclick="navbarResize()"> 
					<i class="fa fa-bars"></i>
				</a>
			</div>
		</header>
		
		<!-- <?php echo htmlspecialchars($_SERVER['PHP_SELF']); ?> --> 
		<!-- content body of website -->
		
		
		<div class="body">
			<section class="contentContainer">
				<form class="doctorConsultation" action="<?php echo $_SERVER['PHP_SELF']; ?>" method="post">
					<div class="doctorConsultation" id="doctorConsultation"> 
						<center><h1>Appointment Timetable</h1></center>
						
						<br> 
							
						<center><input size="50" type="value" placeholder="No current bookings" name="booking" value="<?php echo $value ?>">
						</center>
					
					<br> 

						<center>
							<h3>Fill in Fields to Book or Change</h3>
							<input type="text" style="margin-right:5px" placeholder="Time eg. '2:00'" maxlength="4"name="time" value=""><input type="text" style="margin-right:5px" placeholder="Day eg. '1-31'" maxlength="2"name="day" value=""><input type="text" style="margin-right:5px" placeholder="Month eg. '1-12'" maxlength="2"name="month" value=""><input type="text" placeholder="Doctor Name (lastname)" style="margin-right:5px" name="doctorname" value="">
							
							<br></br>
							
							<button type="submit" name="submit" class="button">Book</button>
							<button type="delete" name="delete" class="button">Delete</button> 
							
							<br> </br>
							
							<p style="color:red"; name="error"><?php echo $message ?></p> 
						</center>
					</div>
				</form>
			</section>
		</div>
		
		
		<!-- fixed footer bar -->
		<div class="footer">
			<div class="etcDetails">
				<a href="MAIN-FAQPage.htm">FAQ</a>
				<a href="MAIN-Terms&ConditionsPage.htm">Terms &amp; Conditions</a>
				<a href="MAIN-PrivacyPage.htm">Privacy</a>
				<a href="MAIN-SecurityPage.htm">Security</a>
			</div>
			
			<p id="copyRight">&copy; 2020 Online Medical Centre - All Rights Reserved.</p>
		</div>
	</body>
</html>